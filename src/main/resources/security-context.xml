<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc 
		http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/security
        http://www.springframework.org/schema/security/spring-security.xsd">
        
	<!-- Spring security -->
	
	<!-- 
	http://static.springsource.org/spring-security/site/docs/3.1.x/reference/springsecurity-single.html
	 -->

	<security:http pattern="/webjars/**" security="none"/>
    <security:http pattern="/css/**" security="none"/>
    <security:http pattern="/img/**" security="none"/>
    <security:http pattern="/js/**" security="none"/>
	<security:http pattern="/favicon.ico" security="none"/>
    
    <security:http auto-config="false" use-expressions="true">
		<security:headers disabled="true"/>
		<security:csrf disabled="false"/>
		<security:intercept-url pattern="/test*/**" access="permitAll"/>
    	<security:intercept-url pattern="/login*" access="permitAll"/>
    	<security:intercept-url pattern="/register*" access="permitAll"/>
    	<security:intercept-url pattern="/confirm*/**" access="permitAll"/>
        <security:intercept-url pattern="/resetPassword*" access="permitAll"/>
        <security:intercept-url pattern="/passwordResetConfirm*/**" access="permitAll"/>
    	<security:intercept-url pattern="/**" access="fullyAuthenticated" />
		<security:form-login login-page="/login"
					username-parameter="j_username"
					password-parameter="j_password"
					login-processing-url="/j_spring_security_check"
					authentication-failure-url="/login?login_error=1"
					default-target-url="/"
					authentication-success-handler-ref="myLoginSuccessHandler"
				 	always-use-default-target="true"/>
    	<security:logout
				logout-url="/logout"
				invalidate-session="true"
				delete-cookies="JSESSIONID" />
  	</security:http>

	<!-- https://www.dailycred.com/article/bcrypt-calculator -->
	<bean id="encoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder">
		<constructor-arg name="strength" value="10" />
	</bean>

  	<security:authentication-manager alias="authenticationManager">
    	<security:authentication-provider user-service-ref="twUserService">
              <security:password-encoder ref="encoder"/>
          </security:authentication-provider>
  	</security:authentication-manager>
  	
  	<bean id="authenticationFilter" class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
  		<property name="authenticationManager" ref="authenticationManager"/>
  		<property name="filterProcessesUrl" value="/j_spring_security_check"/>
	</bean>

</beans>
       