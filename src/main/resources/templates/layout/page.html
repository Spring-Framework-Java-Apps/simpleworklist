<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  xmlns:sd="http://www.thymeleaf.org/spring-data">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta http-equiv="refresh" content="25" th:if="${refreshMessages}">
	<title>SimpleWorklist</title>
	<link th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}" rel="stylesheet"/>
	<link th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}" rel="stylesheet"/>
	<link th:href="@{/webjars/font-awesome/5.8.1/css/all.min.css}" rel="stylesheet"/>
	<link th:href="@{/webjars/tinymce/4.7.9/skins/lightgray/skin.min.css}" rel="stylesheet"/>
	<link th:href="@{/css/main.css}" rel="stylesheet"/>
</head>
<body th:fragment="tw-page-body(twcontent,twtitle)">

	<!-- Navbar on Top -->
	<header>
		<div th:replace="layout/navbartop :: navbartop(contexts=${contexts},locale=${locale},thisProject=${thisProject},numberOfNewIncomingMessages=${numberOfNewIncomingMessages},ctx=${ctx})" >
		</div>
		<div class="jumbotron" id="tw-title-section">
			<div class="container">
				<th:block th:replace="${twtitle}" />
			</div>
		</div>
	</header>

	<section th:replace="layout/navcolleft :: navigation-taskstates(rootCategories=${rootCategories},thisProject=${thisProject})">
	</section>

	<!-- Breadcrumb -->
	<section th:replace="layout/breadcrumb :: breadcrumb(breadcrumb=${breadcrumb})">
	</section>

	<!-- Menu on Left Column and Document Window on the Right Column -->
	<section id="tw-main-section">
		<div class="container">
			<th:block th:replace="${twcontent}" />
		</div>
	</section>

	<section th:replace="layout/navcolleft :: navigation-projects(rootCategories=${rootCategories},thisProject=${thisProject})">
	</section>

	<!-- Footer -->
	<footer class="footer">
		<nav class="navbar fixed-bottom navbar-dark bg-dark">
			<div class="container">
				<span class="navbar-text">© 2019 Thomas Wöhlke</span>
			</div>
		</nav>
	</footer>
	<script th:src="@{/js/google-analytics.js}"></script>
	<script th:src="@{/webjars/jquery/3.3.1/jquery.min.js}"></script>
	<script th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
	<script th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
	<script th:src="@{/webjars/font-awesome/5.8.1/js/all.min.js}"></script>
	<script th:src="@{/webjars/tinymce/4.7.9/tinymce.min.js}"></script>
	<script th:src="@{/webjars/tinymce/4.7.9/jquery.tinymce.min.js}"></script>
	<script th:src="@{/webjars/tinymce/4.7.9/themes/modern/theme.min.js}"></script>
	<script th:inline="javascript">
		$(window).load( function() {
			$( ".taskDraggable").draggable({ cursor: "crosshair", revert: "invalid"  });
			$( ".taskDroppable" ).droppable({
				drop: function( event, ui ) {
					var selfId = ("" + $( this ).attr("id")).split("_")[1];
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					var rootUrl = "";
					if(draggableType == "task") {
						rootUrl = '[(@{/task})]';
					} else if(draggableType == "project") {
						rootUrl = '[(@{/project/task})]';
					}
					var html4move = rootUrl + '/' + draggableId + '/changeorderto/' + selfId;
					window.location.replace(html4move);
				}
			});
			$( ".projectDraggable" ).draggable({ cursor: "crosshair", revert: "invalid"  });
			$( ".projectDroppable" ).droppable({
				drop: function( event, ui ) {
					var selfId = ("" + $( this ).attr("id")).split("_")[1];
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					var url = "";
					if(draggableType == "task"){
						url += '[(@{/task/move})]';
					}
					if (draggableType == "project"){
						url += '[(@{/project/move})]';
					}
					url += draggableId + '/to/project/'+selfId;
					window.location.replace(url);
				}
			});
			$("#taskstate_inbox").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/inbox';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_today").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/today';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_next").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/next';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_waiting").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/waiting';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_someday").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/someday';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_completed").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/completed';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskstate_trash").droppable({
				drop: function( event, ui ) {
					var draggableId = "" +ui.draggable.attr("id").split("_")[1];
					var draggableType = ""+ui.draggable.attr("id").split("_")[0];
					if(draggableType == "task"){
						var html4move = '/task/move/'+draggableId+'/to/trash';
						window.location.replace(html4move);
					}
				}
			});
			$("#taskDueDate ").datepicker({
				dateFormat: 'mm/dd/yy',
				constrainInput: false
			});
			tinymce.init({
				selector: '#task-show-text'
			});
		});
	</script>
</body>
</html>
