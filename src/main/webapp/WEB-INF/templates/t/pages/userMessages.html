<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="t/layout/page :: head">
</head>
<body th:replace="t/layout/page :: tw-page-body(~{::mytwcontent})">
<div th:fragment="mytwcontent">

<!-- Document Window -->
<h1>
    <span th:utext="#{pages.userMessages.h1}">Your Dialog with</span>
    <span th:text="${otherUser.userFullname}">otherUser.userFullname</span>
</h1>
<div class="row">
<div class="well">
<form:form id="formId" commandName="newUserMessage" method="post">
    <div class="form-group">
        <form:label path="messageText">
            <span th:utext="#{pages.userMessages.newMessage}">New Message:</span>
        </form:label>
        <form:textarea path="messageText" rows="3" cols="50" class="form-control"/>
        <form:errors path="messageText" delimiter=", " element="div" class="alert alert-danger"/>
    </div>
    <form:button id="newUserMessageButton" type="submit" class="btn btn-default">
        <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
        <span th:utext="#{pages.userMessages.newUserMessageButton}">Send Message</span>
    </form:button>
</form:form>
</div>
<c:forEach var="m" items="${userMessageList}">
<c:if test="${m.sender.id == otherUser.id}">
<div class="alert alert-danger" role="alert" style="width: 66%; float:right">
</c:if>
<c:if test="${m.sender.id != otherUser.id}">
<div class="alert alert-info" role="alert" style="width: 66%; float:left">
</c:if>
    <c:out value="${m.messageText}" />
    <span style="float:right">
    <small>
    <span th:text="${#dates.format(m.createdTimestamp,'dd.MM.yyyy HH:mm:ss')}"></span>
    <c:if test="${m.readByReceiver}">
        <span class="glyphicon glyphicon-ok" aria-hidden="true">
    </c:if>
    </small>
    </span>
</div>
</c:forEach>
</div>
<div class="row">
    <c:if test="${userMessageList.size() < 21}">
        <a th:href="@{/user/{id}/messages/all(id=${otherUser.id})}">
            <span th:utext="#{pages.userMessages.showAllText1}">Zeige alle Nachrichten</span>
        </a>
        <span th:utext="#{pages.userMessages.showAllText2}">(hier werden nur die letzten 20 Angezeigt)</span>
    </c:if>
</div>



</div>
</body>
</html>
